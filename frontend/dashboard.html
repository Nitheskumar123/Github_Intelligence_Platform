<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - GitHub Intelligence Platform</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>

<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <svg class="logo-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 2v20M2 12h20"></path>
                </svg>
                <span class="logo-text">GitHub Intelligence</span>
            </div>

            <div class="nav-right">
                <div class="user-profile">
                    <img id="userAvatar" src="" alt="User Avatar" class="user-avatar">
                    <span id="userName" class="user-name">Loading...</span>
                </div>
                <button id="logoutBtn" class="btn-logout">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-section="overview">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <span>Overview</span>
                </a>

                <a href="#" class="nav-item" data-section="repositories">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>Repositories</span>
                </a>

                <a href="#" class="nav-item" data-section="ai-chat">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>AI Assistant</span>
                    <span class="badge">Soon</span>
                </a>

                <a href="#" class="nav-item" data-section="analytics">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    <span>Analytics</span>
                    <span class="badge">Soon</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Overview Section -->
            <section id="overview" class="content-section active">
                <div class="section-header">
                    <h1>Welcome Back!</h1>
                    <p class="section-subtitle">Here's what's happening with your repositories</p>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
                                </path>
                            </svg>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="totalRepos">0</div>
                            <div class="stat-label">Total Repositories</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon
                                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                </polygon>
                            </svg>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="totalStars">0</div>
                            <div class="stat-label">Total Stars</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="totalForks">0</div>
                            <div class="stat-label">Total Forks</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="openIssues">0</div>
                            <div class="stat-label">Open Issues</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="action-buttons">
                        <button id="syncReposBtn" class="action-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                            </svg>
                            Sync Repositories
                        </button>
                        <button class="action-btn" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            Chat with AI
                            <span class="badge-small">Soon</span>
                        </button>
                        <button class="action-btn" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            View Analytics
                            <span class="badge-small">Soon</span>
                        </button>
                    </div>
                </div>

                <!-- Getting Started -->
                <div class="getting-started">
                    <h2>ðŸš€ Getting Started</h2>
                    <div class="steps-list">
                        <div class="step-item completed">
                            <div class="step-check">âœ“</div>
                            <div class="step-content">
                                <h3>Connected GitHub Account</h3>
                                <p>Your GitHub account is successfully linked</p>
                            </div>
                        </div>
                        <div class="step-item" id="syncStep">
                            <div class="step-check">2</div>
                            <div class="step-content">
                                <h3>Sync Your Repositories</h3>
                                <p>Click "Sync Repositories" to load your repos</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-check">3</div>
                            <div class="step-content">
                                <h3>Explore AI Features</h3>
                                <p>Coming soon: Natural language repo management</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Repositories Section -->
            <section id="repositories" class="content-section">
                <div class="section-header">
                    <h1>Your Repositories</h1>
                    <button id="refreshReposBtn" class="btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <polyline points="1 20 1 14 7 14"></polyline>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                        Refresh
                    </button>
                </div>

                <div id="repositoriesList" class="repositories-list">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
                            </path>
                        </svg>
                        <h3>No Repositories Yet</h3>
                        <p>Click "Sync Repositories" to load your GitHub repos</p>
                        <button id="syncFromEmptyBtn" class="btn-primary">Sync Now</button>
                    </div>
                </div>
            </section>

            <!-- AI Chat Section (Coming Soon) -->
            <section id="ai-chat" class="content-section">
                <div class="section-header">
                    <h1>AI Assistant</h1>
                    <span class="badge">Coming Soon</span>
                </div>
                <div class="coming-soon">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <h2>AI-Powered Repository Management</h2>
                    <p>Soon you'll be able to manage your repositories through natural conversation</p>
                    <ul class="feature-list">
                        <li>Create and manage issues</li>
                        <li>Review pull requests</li>
                        <li>Generate documentation</li>
                        <li>Get intelligent insights</li>
                    </ul>
                </div>
            </section>

            <!-- Analytics Section (Coming Soon) -->
            <section id="analytics" class="content-section">
                <div class="section-header">
                    <h1>Analytics</h1>
                    <span class="badge">Coming Soon</span>
                </div>
                <div class="coming-soon">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    <h2>Team & Code Analytics</h2>
                    <p>Comprehensive insights into your development workflow</p>
                    <ul class="feature-list">
                        <li>Bug pattern prediction</li>
                        <li>Team cognitive load monitoring</li>
                        <li>Code quality metrics</li>
                        <li>Productivity analytics</li>
                    </ul>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p id="loadingText">Loading...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/auth.js"></script>
    <script>
        // Dashboard specific functionality
        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication
            if (!await checkAuth()) {
                window.location.href = '/';
                return;
            }

            // Load user info
            await loadUserInfo();

            // Load repositories
            await loadRepositories();

            // Setup event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }

            // Sync repositories button
            const syncReposBtn = document.getElementById('syncReposBtn');
            if (syncReposBtn) {
                syncReposBtn.addEventListener('click', syncRepositories);
            }

            // Refresh repositories button
            const refreshReposBtn = document.getElementById('refreshReposBtn');
            if (refreshReposBtn) {
                refreshReposBtn.addEventListener('click', loadRepositories);
            }

            // Sync from empty state button
            const syncFromEmptyBtn = document.getElementById('syncFromEmptyBtn');
            if (syncFromEmptyBtn) {
                syncFromEmptyBtn.addEventListener('click', syncRepositories);
            }

            // Sidebar navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.dataset.section;
                    switchSection(section);
                });
            });
        }

        function switchSection(sectionId) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

            // Update active section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        async function loadUserInfo() {
            try {
                const user = await apiRequest('/api/user/me/');
                document.getElementById('userName').textContent = user.github_login || user.username;
                document.getElementById('userAvatar').src = user.github_avatar_url || 'https://via.placeholder.com/40';
            } catch (error) {
                showToast('Failed to load user info', 'error');
            }
        }

        async function loadRepositories() {
            try {
                showLoading('Loading repositories...');
                const repos = await apiRequest('/api/repositories/');
                displayRepositories(repos);
                updateStats(repos);
                hideLoading();
            } catch (error) {
                hideLoading();
                showToast('Failed to load repositories', 'error');
            }
        }

        async function syncRepositories() {
            try {
                showLoading('Syncing repositories from GitHub...');
                const result = await apiRequest('/api/repositories/sync/', 'POST');
                showToast(result.message, 'success');
                await loadRepositories();
                document.getElementById('syncStep').classList.add('completed');
            } catch (error) {
                hideLoading();
                showToast('Failed to sync repositories', 'error');
            }
        }

        function displayRepositories(repos) {
            const container = document.getElementById('repositoriesList');

            if (repos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <h3>No Repositories Yet</h3>
                        <p>Click "Sync Repositories" to load your GitHub repos</p>
                        <button onclick="syncRepositories()" class="btn-primary">Sync Now</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = repos.map(repo => `
                <div class="repo-card">
                    <div class="repo-header">
                        <h3 class="repo-name">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                            </svg>
                            ${repo.full_name}
                        </h3>
                        ${repo.is_private ? '<span class="badge-private">Private</span>' : '<span class="badge-public">Public</span>'}
                    </div>
                    ${repo.description ? `<p class="repo-description">${repo.description}</p>` : ''}
                    <div class="repo-meta">
                        ${repo.language ? `<span class="meta-item"><span class="language-dot" style="background-color: ${getLanguageColor(repo.language)}"></span>${repo.language}</span>` : ''}
                        <span class="meta-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                            ${repo.stars_count}
                        </span>
                        <span class="meta-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                            ${repo.forks_count}
                        </span>
                    </div>
                    <div class="repo-actions">
                        <a href="${repo.html_url}" target="_blank" class="btn-link">
                            View on GitHub
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                        </a>
                    </div>
                </div>
            `).join('');
        }

        function updateStats(repos) {
            const totalRepos = repos.length;
            const totalStars = repos.reduce((sum, repo) => sum + repo.stars_count, 0);
            const totalForks = repos.reduce((sum, repo) => sum + repo.forks_count, 0);
            const openIssues = repos.reduce((sum, repo) => sum + repo.open_issues_count, 0);

            document.getElementById('totalRepos').textContent = totalRepos;
            document.getElementById('totalStars').textContent = totalStars;
            document.getElementById('totalForks').textContent = totalForks;
            document.getElementById('openIssues').textContent = openIssues;
        }

        function getLanguageColor(language) {
            const colors = {
                'JavaScript': '#f1e05a',
                'Python': '#3572A5',
                'Java': '#b07219',
                'TypeScript': '#2b7489',
                'C++': '#f34b7d',
                'C': '#555555',
                'C#': '#178600',
                'PHP': '#4F5D95',
                'Ruby': '#701516',
                'Go': '#00ADD8',
                'Rust': '#dea584',
                'Swift': '#ffac45',
                'Kotlin': '#F18E33',
                'HTML': '#e34c26',
                'CSS': '#563d7c',
            };
            return colors[language] || '#858585';
        }

        function showLoading(text = 'Loading...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;

            const container = document.getElementById('toastContainer');
            container.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>

</html>